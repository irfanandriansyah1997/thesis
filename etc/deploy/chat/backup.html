<html>
    <head>
        <title>Realtime Chat</title>
        <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
            integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
            crossorigin="anonymous"
        />
        <script
            src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
            integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
            crossorigin="anonymous"
        ></script>
        <style>
            .message-bubble {
                padding: 10px 0px 10px 0px;
            }
            .message-bubble:nth-child(even) {
                background-color: #f5f5f5;
            }
            .message-bubble > * {
                padding-left: 10px;
            }
            .panel-body {
                padding: 0px;
            }
            .panel-heading {
                background-color: #3d6da7 !important;
                color: white !important;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="row">
                <div class="panel panel-default">
                    <div class="panel-heading">Panel heading without title</div>
                    <div class="panel-body" id="apps">
                        <div class="container" id="chat_data"></div>
                        <div class="panel-footer">
                            <div class="row">
                                <div class="col-md-4">
                                    <input
                                        type="text"
                                        id="name"
                                        class="form-control"
                                    />
                                </div>
                                <div class="col-md-8">
                                    <div class="input-group">
                                        <input
                                            type="text"
                                            id="msg"
                                            class="form-control"
                                        />
                                        <span class="input-group-btn">
                                            <button
                                                class="btn btn-default"
                                                type="button"
                                            >
                                                Send
                                            </button>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-database.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/locale/id.min.js"></script>
        <script>
            var firebaseConfig = {
                projectId: 'test-1346f',
                messagingSenderId: '747812239219',
                storageBucket: 'test-1346f.appspot.com',
                authDomain: 'test-1346f.firebaseapp.com',
                apiKey: 'AIzaSyCf-pMcBdZqiqArSoLBYqsMjKec7CnbNtg',
                databaseURL: 'https://test-1346f.firebaseio.com',
                appId: '1:747812239219:web:5831c5e40cc5d71b603706'
            };

            firebase.initializeApp(firebaseConfig);

            $(document).ready(function() {
                var rootchatref = firebase.database().ref('/');
                var chatref = firebase.database().ref('/Chat');
                chatref.on('child_added', function(snapshot) {
                    var data = snapshot.val();
                    //console.log(data);
                    $('#chat_data').prepend(
                        '<div class="row message-bubble"><p class="text-muted">' +
                            data.user +
                            '</p><span>' +
                            data.msg +
                            '</span></div>'
                    );
                });
            });

            function writeChat(user, msg) {
                // A post entry.
                var postData = {
                    msg: msg,
                    user: user
                };
                // Get a key for a new Post.
                var newPostKey = firebase
                    .database()
                    .ref()
                    .child('Chat')
                    .push().key;
                // Write the new post's data simultaneously in the posts list and the user's post list.
                var updates = {};
                updates['/Chat/' + newPostKey] = postData;
                return firebase
                    .database()
                    .ref()
                    .update(updates);
            }

            $('#msg').keypress(function(e) {
                var name = $('#name').val();
                var msg = $('#msg').val();
                if (e.which == 13) {
                    if (name == '') {
                        alert('Isi nama terlebih dahulu..');
                        $('#name').focus();
                        return false;
                    }
                    if (msg == '') {
                        alert('Pesan tidakk boleh kosong');
                        $('#msg').focus();
                        return false;
                    }
                    writeChat(name, msg);
                    $('#msg').val('');
                }
            });
        </script>
    </body>
</html>
